/**
 * Manager for the modal dialog that views a parameter sweep simulation
 */
var ViewParameterSweepSimulationModal = {
    
    modalId: "view-simulation-modal",
    closeButtonId: "view-simulation-modal-close",
    simulationId: null,
    
    init: function(){
        
    },
    
    showModal: function(){
        $('#' + this.modalId).modal('show');
    },
    
    hideModal: function(){
        $('#' + this.modalId).modal('hide');
    },
    
    viewParameterSweepSimulation: function(simulationId){
        this.simulationId = simulationId;
        
        this.getSimulationDescription();
        this.getSimulationParameters();
        this.getSimulationOutputFiles();
        this.showModal();
        //show the first tab when opening the modal
        $('#view-simulation-details-tabs a:first').tab('show');
    },
    
    getSimulationDescription: function(){
        $.ajax({
            dataType: "json",
            url: getBaseApiUrl() + "/users/username/projects/" + G_VARS["projectId"] + "/parametersweepsimulations/" + ViewParameterSweepSimulationModal.simulationId,
            method: "GET",
            success : function(data) {
                ViewParameterSweepSimulationModal.setSimulationDescriptionTab(data);
            },
            error : function(xhr, status) {
                alert(status);
            },
 
            // código a ejecutar sin importar si la petición falló o no
            complete : function(xhr, status) {
                //alert(status);
            }
        });
    },
            
    getSimulationParameters: function(){
        $.ajax({
            dataType: "json",
            url: getBaseApiUrl() + "/users/username/projects/" + G_VARS["projectId"] + "/parametersweepsimulations/" + ViewParameterSweepSimulationModal.simulationId + "/parameters/",
            method: "GET",
            success : function(data) {
                ViewParameterSweepSimulationModal.setSimulationParametersTab(data);
            },
            error : function(xhr, status) {
                alert(status);
            },
 
            // código a ejecutar sin importar si la petición falló o no
            complete : function(xhr, status) {
            //alert(status);
            }
        });
    },
    
    getSimulationOutputFiles: function(){
        $.ajax({
            dataType: "json",
            url: getBaseApiUrl() + "/users/username/projects/" + G_VARS["projectId"] + "/parametersweepsimulations/" + ViewParameterSweepSimulationModal.simulationId + "/outputfiles/",
            method: "GET",
            //data: {projectId: 1},
            success : function(data) {
                ViewParameterSweepSimulationModal.setSimulationOutputFiles(data);
            },
            error : function(xhr, status) {
                alert(status);
            },

            // código a ejecutar sin importar si la petición falló o no
            complete : function(xhr, status) {
            //alert(status);
            }
        });
      
    },
    
    setSimulationDescriptionTab: function(simulation){
        var details_tp = $("#view-simulation-details-tp-desc");
        details_tp.empty();
        var div_inf_panel = $('<div class="information-panel"></div');
        var panel_content = "";
        panel_content += '<span class="title">Nombre</span>' + simulation.name;
        panel_content += '<span class="title">Número de repeticiones</span>' + simulation.numRepetitions;
        panel_content += '<span class="title">Tipo de simulación</span>' + 'Barrido de parámetros';
        panel_content += '<span class="title">Estado</span>' + simulation.status;
        panel_content += '<span class="title">Fecha de creación</span>' + simulation.creationDate;
        panel_content += '<span class="title">Última modificación</span>' + simulation.updateDate;
        panel_content += '<span class="title">Simulaciones completadas</span>' + simulation.completedSimulations;
        panel_content += '<span class="title">Simulaciones totales</span>' + simulation.totalSimulations;
        details_tp.append(div_inf_panel);
        div_inf_panel.html(panel_content);
    },
    
    setSimulationParametersTab: function(parameters){
        var params_tp = $("#view-simulation-details-tp-params");
        params_tp.empty();
        for (var i = 0; i < parameters.length; i++){
            var param = parameters[i];
            var div_inf_panel = $('<div class="information-panel"></div');
            params_tp.append(div_inf_panel);
            var panel_title = $('<div class="information-panel-title expandable"></div>');
            div_inf_panel.append(panel_title);
            var panel_title_html = '<span class="title">' + param.name + '<span class="glyphicon glyphicon-triangle-bottom pull-right" aria-hidden="true"></span></span>';
            panel_title.html(panel_title_html);
            var panel_content = $('<div class="information-panel-content"></div>');
            div_inf_panel.append(panel_content);
            var panel_content_html = '';
            if (typeof param.values != 'undefined'){
                panel_content_html += '<span class="title">Valores</span>' + param.values.join(", ");
            }else if (typeof param.minValue != 'undefined' && typeof param.step != 'undefined' && typeof param.maxValue != 'undefined'){
                panel_content_html += '<span class="title">Mínimo</span>' + param.minValue + '<span class="title">Incremento</span>' + param.step + '<span class="title">Máximo</span>' + param.maxValue;
            }else if (param.random){
                panel_content_html += '<span class="title">Valor</span>' + 'random';
            }
            
            panel_content.html(panel_content_html);
            setExpandableSection(div_inf_panel[0]);
        }
    },
    
    setSimulationOutputFiles: function(outputFiles){
        var output_files_tp = $("#view-simulation-details-tp-files");
        output_files_tp.empty();
        for (var i = 0; i < outputFiles.length; i++){
            var outputFile = outputFiles[i];
            var outputFileStructure = outputFile.outputFileStructure;
            var div_inf_panel = $('<div class="information-panel"></div');
            output_files_tp.append(div_inf_panel);
            var panel_title = $('<div class="information-panel-title expandable"></div>');
            div_inf_panel.append(panel_title);
            var panel_title_html = '<span class="title">' + outputFile.outputFileName + '<span class="glyphicon glyphicon-triangle-bottom pull-right" aria-hidden="true"></span></span>';
            panel_title.html(panel_title_html);
            
            var panel_content = $('<div class="information-panel-content"></div>');
            div_inf_panel.append(panel_content);
            var panel_content_html = '';
            panel_content_html += '<span class="title">Tipo</span>' + outputFile.type;
            panel_content_html += '<span class="title">Multilínea</span>';
            if (outputFileStructure.multiLine){
                panel_content_html += 'Sí';
            }else{
                panel_content_html += 'No';
            }
            panel_content_html += '<span class="title">Variables de salida</span>';
            
            var output_vars = outputFileStructure.outputVariables;
            for (var j = 0; j < output_vars.length; j++){
                panel_content_html += output_vars[j];
                if (j < (output_vars.length-1)){
                    panel_content_html += ', ';
                }
            }
            panel_content.html(panel_content_html);
            setExpandableSection(div_inf_panel[0]);
        }
    }
};

