<?php

/* Copyright (C) 2015 Intelligent & Cooperative Systems Research Group/Education,
  Media, Computing & Culture (GSIC-EMIC). University of Valladolid(UVA).
  Valladolid, Spain. https://www.gsic.uva.es/

  This file is part of Web Collage.

  Web Collage is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  Web Collage is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>. */
require_once("rest.php");
require_once("resources/SimulationProjectListResource.php");
require_once("resources/SimulationProjectResource.php");

$data = RestUtils::processRequest();
if (isset($_REQUEST["_route_"])) {
    $route = "/" . $_REQUEST["_route_"];
    $request_vars = $data->getRequestVars();
    $route_array = explode("/", $route);
    array_shift($route_array);
    if (strcmp($route_array[count($route_array) - 1], "") == 0) {
        array_pop($route_array);
    }
    if (strcmp($route_array[0], "users") == 0) {
        if (count($route_array) == 3) {
            //echo "/DNSE3/api/users/{username}/projects/";
            $method = $data->getMethod();
            $accept = $data->getHttpAccept();
            $username = $route_array[1];
            $sim_project_list_resource = new SimulationProjectListResource($method, $accept, $username);
            $response = $sim_project_list_resource->exec();
            RestUtils::sendResponse($response->getStatus(), $response->getBody(), $response->getContentType());
        }
        if (count($route_array) == 4) {
            //echo "/DNSE3/api/users/{username}/projects/{projectId}/";
            $method = $data->getMethod();
            $accept = $data->getHttpAccept();
            $username = $route_array[1];
            $projectId = $route_array[3];
            $sim_project_resource = new SimulationProjectResource($method, $accept, $username, $projectId, $request_vars);
            $response = $sim_project_resource->exec();
            RestUtils::sendResponse($response->getStatus(), $response->getBody(), $response->getContentType());
        }
    }
    RestUtils::sendResponse(404, '', 'text/html');
} else {
    RestUtils::sendResponse(404, '', 'text/html');
}
?>
