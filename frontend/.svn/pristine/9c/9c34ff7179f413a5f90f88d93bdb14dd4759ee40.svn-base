var ProjectsPainter = {
    
    projects: null,
    
    init: function(){
    },
    
    paint: function(){
        ProjectsPainter.getSimulationProjects();
    },
    
    paintProjectsTable: function(){
        $("#simulationProjectsTable").removeClass("hidden");
        $("#noSimulationProjectsAlert").addClass("hidden");
        var table_body = $("#simulationProjectsTable > tbody");
        table_body.empty();
        for (var i = 0; i < this.projects.length; i++){
            var creation_date_field = "";
            var creation_date_date = new Date(this.projects[i].creationDate);
            //creation_date_date.setHours(creation_date_date.getHours()+1);//important!! add one hour to match the local time
            var creation_date_ts = dateToTimestamp(creation_date_date);
            
            var now_date = new Date();
            var now_ts = dateToTimestamp(now_date);
            
            //get the difference in seconds between both timestamps
            var diff_seconds = now_ts - creation_date_ts;  
            if (diff_seconds < 60){//less than a minute
                creation_date_field = "Hace menos de un minuto";
            }else if(diff_seconds < 60*60){//less than an hour
                creation_date_field = "Hace " + Math.floor(diff_seconds/60) + " minutos";
            }else if (diff_seconds < 60*60*24){//less than a day
                creation_date_field = "Hace " + Math.floor(diff_seconds/(60*60)) + " horas";
            }else{
                creation_date_field += dateFormat(creation_date_date);
            }
            
            var update_date_field = "";
            var update_date_date = new Date(this.projects[i].updateDate);
            //update_date_date.setHours(update_date_date.getHours()+1);//important!! add one hour to match the local time
            var update_date_ts = dateToTimestamp(update_date_date);
            
            //get the difference in seconds between both timestamps
            var diff_seconds = now_ts - update_date_ts;  
            if (diff_seconds < 60){//less than a minute
                update_date_field = "Hace menos de un minuto";
            }else if(diff_seconds < 60*60){//less than an hour
                update_date_field = "Hace " + Math.floor(diff_seconds/60) + " minutos";
            }else if (diff_seconds < 60*60*24){//less than a day
                update_date_field = "Hace " + Math.floor(diff_seconds/(60*60)) + " horas";
            }else{
                update_date_field += dateFormat(update_date_date);
            }
            
            var table_tr = $("<tr></tr>");
            var td_name = $('<td><a href="' + getBaseUrl() + 'php/controller/simulationProject.php?projectId=' + this.projects[i].projectId + '">' + this.projects[i].name + '</a></td>');
            var td_single_sim = $("<td>" + this.projects[i].numSingleSimulations + "</td>");
            var td_param_sweep_sim = $("<td>" + this.projects[i].numParameterSweepSimulations + "</td>");
            var td_param_cd = $("<td>" + creation_date_field + "</td>");
            var td_param_ud = $("<td>" + update_date_field + "</td>");
            var td_actions = $('<td class="actions"><div class="btn-group actions-group">' +
                                        '<button class="btn btn-default btn-sm" onclick="ViewProjectModal.viewProject(' + this.projects[i].projectId + ')"><span class="glyphicon glyphicon-search" aria-hidden="true"></span> Ver detalles</button>' +
                                        '<button data-toggle="dropdown" class="btn btn-default btn-sm dropdown-toggle"><span class="caret"></span></button>' +
                                        '<ul class="dropdown-menu">' +
                                            '<li><a href="#" onclick="NewSimulationModal.newSimulation(' + this.projects[i].projectId + ')"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Nueva simulaci贸n</a></li>' +
                                            '<li><a href="#" onclick="EditProjectModal.editProject(' + this.projects[i].projectId + ')"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span> Editar proyecto</a></li>' +
                                            '<li><a href="#" onclick="DeleteProjectModal.deleteProject(' + this.projects[i].projectId + ')"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span> Eliminar proyecto</a></li>' +
                                        '</ul>' +
                                    '</div></td>');
           table_tr.append(td_name);
           table_tr.append(td_single_sim);
           table_tr.append(td_param_sweep_sim);
           table_tr.append(td_param_cd);
           table_tr.append(td_param_ud);
           table_tr.append(td_actions);
           table_body.append(table_tr);
        }
    },
    
    /**
     * Hide the table for the single simulations and shows an alert message
     */
    showNoProjects: function(){
        $("#simulationProjectsTable").addClass("hidden");
        $("#noSimulationProjectsAlert").removeClass("hidden");
    },
    
    getSimulationProjects: function(){
        $.ajax({
            url: getBaseApiUrl() + "/users/username/projects/",
            method: "GET",
            dataType: "json",//the expected data type from the server
            success : function(data) {
                ProjectsPainter.projects = data;
                if (ProjectsPainter.projects.length > 0){
                    ProjectsPainter.paintProjectsTable();
                }else{
                    ProjectsPainter.showNoProjects();
                }
            },
            error : function(xhr, status) {
                manageRequestError(xhr, status);
            },
 
            // c贸digo a ejecutar sin importar si la petici贸n fall贸 o no
            complete : function(xhr, status) {
                //alert(status);
            }
        });
    }
};


